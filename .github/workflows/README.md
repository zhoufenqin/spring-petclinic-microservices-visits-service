# GitHub Actions Workflows

This directory contains GitHub Actions workflows for the Spring PetClinic Visits Service.

## Workflows

### 1. Application Assessment (`appcat-analysis.yml`)

This workflow performs an application assessment and updates a GitHub issue with the assessment report.

**Trigger:** Manual workflow dispatch

**Inputs:**
- `issue_url`: GitHub issue URL to update with the report (default: https://github.com/zhoufenqin/spring-petclinic-microservices/issues/8)

**Features:**
- Reads the assessment report from `.github/workflows/report.json`
- Generates a comprehensive summary with:
  - Overall statistics by application and target Azure service
  - Application profiles (JDK version, frameworks, languages, build tools)
  - Key findings with severity levels and effort estimates
- Posts the summary as comments to the specified GitHub issue
- Handles large reports by splitting into multiple comments if needed

**Usage:**
1. Go to the Actions tab in the repository
2. Select "Application Assessment" workflow
3. Click "Run workflow"
4. Optionally specify a different issue URL
5. Click "Run workflow" to execute

### 2. Upload Assessment Report (`upload-report.yml`)

This workflow uploads the assessment report to the parent repository for centralized tracking.

**Trigger:** Manual workflow dispatch

**Inputs:**
- `report_path`: Path to the report.json file (default: `.github/workflows/report.json`)
- `target_repo`: Target repository in format `owner/repo` (default: `zhoufenqin/spring-petclinic-microservices`)
- `target_folder`: Target folder in the repository (default: `app-modernization`)

**Features:**
- Verifies the report file exists before upload
- Checks out both source and target repositories
- Creates the target folder if it doesn't exist
- Uploads the report with:
  - Timestamped filename (e.g., `visits-service_report_20231216T123456Z.json`)
  - Latest copy (e.g., `visits-service_report_latest.json`)
- Commits and pushes changes to the target repository
- Provides detailed logging and summary

**Authentication:**
The workflow requires write access to the target repository and **PAT_TOKEN** secret must be configured.

**Setting up PAT_TOKEN (Required):**
1. Create a Personal Access Token with `repo` scope at https://github.com/settings/tokens
   - You can use either a classic token or a fine-grained token
   - For fine-grained tokens, grant "Contents" read and write permissions for the target repository
   - The token must be from an account with write access to the target repository
2. Add the token as a repository secret named `PAT_TOKEN`:
   - Go to repository Settings → Secrets and variables → Actions
   - Click "New repository secret"
   - Name: `PAT_TOKEN`
   - Value: Your personal access token
   - Click "Add secret"

**Usage:**
1. Go to the Actions tab in the repository
2. Select "Upload Assessment Report" workflow
3. Click "Run workflow"
4. Optionally customize the inputs:
   - Report path (if different from default)
   - Target repository (if different)
   - Target folder (if different)
5. Click "Run workflow" to execute

**Output:**
After successful execution, the report will be available at:
`https://github.com/{target_repo}/tree/main/{target_folder}/`

For example:
`https://github.com/zhoufenqin/spring-petclinic-microservices/tree/main/app-modernization/`

## Report File

### `report.json`

This file contains the application modernization assessment report generated by the Java AppCAT CLI tool.

**Content:**
- **Metadata:** Analysis timestamp, privacy mode, target Azure services
- **Summary:** Total projects, issues, incidents, effort, severity distribution
- **Projects:** Detailed analysis per project including:
  - Application properties (name, JDK version, frameworks, languages, tools)
  - Incidents with rule violations
  - Location information (file, line, column)
  - Severity and effort estimates per target Azure service
- **Rules:** Complete rule definitions with descriptions, links, and severity levels

**Target Azure Services:**
- Azure Kubernetes Service (AKS)
- Azure Container Apps
- Azure App Service

**Severity Levels:**
- **Mandatory:** Must be resolved for successful migration
- **Potential:** May be blocking in some situations, requires review
- **Optional:** Improvements that enhance the app post-migration
- **Information:** Discovery data for planning purposes

## Maintenance

When adding new workflows:
1. Use descriptive names following the pattern: `action-description.yml`
2. Add comprehensive inline documentation with comments
3. Include `workflow_dispatch` trigger for manual testing
4. Update this README with workflow documentation
5. Add appropriate error handling and logging
6. Use GitHub Actions best practices for secrets management
